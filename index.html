<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigerian Fake News Detector</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f2f5;
        }
        /* Custom scrollbar for text area */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-gray-100">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-xl border border-gray-200">
        <h1 class="text-4xl font-extrabold text-center mb-8 text-gray-900 leading-tight">
            Nigerian Fake News Detector
        </h1>

        <div class="mb-6">
            <label for="headlineInput" class="block text-gray-800 text-lg font-semibold mb-3">
                Enter News Headline or Article Text:
            </label>
            <textarea
                id="headlineInput"
                class="shadow-sm appearance-none border border-gray-300 rounded-xl w-full py-4 px-5 text-gray-700 leading-tight focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 transition duration-300 ease-in-out text-base resize-y min-h-[150px]"
                rows="6"
                placeholder="Paste the news content here (e.g., 'BREAKING: Governor declares national holiday tomorrow for election celebrations!'). For best results, paste substantial text."
            ></textarea>
        </div>

        <button
            id="checkButton"
            class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-75 transition duration-300 ease-in-out shadow-lg transform hover:scale-105"
        >
            <span id="buttonText">Check News Veracity</span>
            <span id="loadingSpinner" class="hidden ml-2">
                <svg class="animate-spin h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </span>
        </button>

        <div id="results" class="mt-8 p-6 bg-gray-50 rounded-xl shadow-inner border border-gray-200 hidden">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Analysis Results:</h2>
            <div class="space-y-3 text-gray-700 text-base">
                <p><strong>AI Classification:</strong> <span id="aiClassification" class="font-semibold text-blue-700"></span></p>
                <p><strong>Confidence:</strong> <span id="confidenceScore" class="font-semibold text-blue-700"></span></p>
                <p><strong>Simulated Time Spent:</strong> <span id="timeSpent" class="font-medium"></span></p>
                <p><strong>Simulated Total Sites Checked:</strong> <span id="totalSites" class="font-medium"></span></p>
                <p><strong>Simulated Matching Sites Count:</strong> <span id="matchingSitesCount" class="font-medium"></span></p>
                <div class="mt-3">
                    <p class="font-semibold mb-2">Simulated Sites Containing Similar Content:</p>
                    <ul id="matchingSitesList" class="list-disc pl-6 text-gray-600 text-sm">
                        <!-- Simulated matching sites will be listed here -->
                    </ul>
                    <p id="noMatchingSites" class="text-gray-500 italic text-sm hidden">
                        No specific simulated matches found for this input.
                    </p>
                </div>
            </div>
        </div>

        <!-- Custom Modal for Alerts -->
        <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full border border-gray-300">
                <p id="messageText" class="text-gray-800 text-xl font-semibold text-center mb-6"></p>
                <button
                    id="closeMessageBox"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-500 transition duration-200 ease-in-out shadow-md"
                >
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const headlineInput = document.getElementById('headlineInput');
            const checkButton = document.getElementById('checkButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultsDiv = document.getElementById('results');
            const aiClassificationSpan = document.getElementById('aiClassification');
            const confidenceScoreSpan = document.getElementById('confidenceScore');
            const timeSpentSpan = document.getElementById('timeSpent');
            const totalSitesSpan = document.getElementById('totalSites');
            const matchingSitesCountSpan = document.getElementById('matchingSitesCount');
            const matchingSitesList = document.getElementById('matchingSitesList');
            const noMatchingSitesP = document.getElementById('noMatchingSites');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBox = document.getElementById('closeMessageBox');

            // Replace with your Google Cloud Project API Key if needed for models other than gemini-2.0-flash
            // For gemini-2.0-flash, Canvas environment automatically provides the API key.
            const API_KEY = "AIzaSyDMotjubuT252Ips9PWtUZ_AuRVPXmsLUc";
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

            // Simulated list of Nigerian news sites for display purposes
            const dummySites = [
                "Premium Times", "The Guardian", "Channels Television", "Sahara Reporters",
                "Vanguard", "The Nation", "Daily Trust", "Punch Newspaper",
                "BBC News Pidgin", "Legit.ng", "Pulse.ng", "Naija News",
                "Arise News", "TVC News", "ThisDay Live", "Daily Post",
                "The Sun", "Leadership Newspaper", "Nigerian Tribune", "Daily Independent"
            ];

            // Function to display messages in a custom modal
            function showMessage(message) {
                messageText.textContent = message;
                messageBox.classList.remove('hidden');
            }

            closeMessageBox.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            checkButton.addEventListener('click', async () => {
                const textInput = headlineInput.value.trim();

                if (textInput === "") {
                    showMessage("Please enter news content to analyze.");
                    return;
                }

                // Show loading state
                buttonText.textContent = "Analyzing...";
                loadingSpinner.classList.remove('hidden');
                checkButton.disabled = true;
                resultsDiv.classList.add('hidden'); // Hide previous results

                const startTime = performance.now(); // Start timer

                let aiClassification = "N/A";
                let confidenceScore = 0.0;

                try {
                    // Prepare the prompt for the Gemini API
                    // We instruct the LLM to classify the text as REAL or FAKE NEWS.
                    // This is how the AI will provide a 'FAKE' classification.
                    const prompt = `Classify the following Nigerian news content as either "REAL NEWS" or "FAKE NEWS".
                    Focus on common characteristics of misinformation like sensationalism, unverified claims, conspiracy theories, or clear factual inaccuracies often found in fake news, especially in a political context. If it sounds like legitimate reporting, classify it as REAL NEWS.
                    
                    Respond ONLY with "REAL NEWS" or "FAKE NEWS", followed by a confidence score (0.0 to 1.0) in parentheses. For example: "FAKE NEWS (0.95)" or "REAL NEWS (0.88)".

                    News Content: "${textInput}"`;

                    const payload = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: {
                            temperature: 0.2, // Keep temperature low for deterministic classification
                            topP: 0.95,
                            topK: 40,
                            responseMimeType: "text/plain" // Request plain text response
                        }
                    };

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        
                        const textResponse = result.candidates[0].content.parts[0].text;
                        // Attempt to parse the AI's response "REAL NEWS (0.XX)" or "FAKE NEWS (0.XX)"
                        // Updated regex to correctly parse 1.0 as a confidence score
                        const match = textResponse.match(/(REAL NEWS|FAKE NEWS)\s*\(([\d\.]+)\)/i);
                        if (match) {
                            aiClassification = match[1].toUpperCase();
                            confidenceScore = parseFloat(match[2]);
                        } else {
                            aiClassification = "UNCLEAR (AI format error)";
                            confidenceScore = 0.0;
                            console.error("AI response format unexpected:", textResponse);
                        }
                    } else {
                        aiClassification = "AI Response Empty";
                        confidenceScore = 0.0;
                        console.error("AI response candidates empty or malformed:", result);
                    }

                } catch (error) {
                    aiClassification = `AI Error: ${error.message}`;
                    confidenceScore = 0.0;
                    console.error("Error calling Gemini API:", error);
                }

                const endTime = performance.now(); // End timer
                const timeTaken = ((endTime - startTime) / 1000).toFixed(2); // Convert to seconds

                // Simulate site checking (Illustrative only, NOT real web scraping)
                const totalSitesChecked = dummySites.length;
                let simulatedMatchingSites = [];
                const lowerInput = textInput.toLowerCase();

                // Heuristic for dummy matches: more likely to match if classified as FAKE by the AI,
                // or if specific keywords are present. This is for visual demo purposes only.
                if (aiClassification === "FAKE NEWS" && confidenceScore > 0.6) {
                    // If AI is confident it's fake, simulate more matching sites
                    const numMatches = Math.floor(Math.random() * (dummySites.length / 3)) + 1; // 1 to 1/3 of total sites
                    for (let i = 0; i < numMatches; i++) {
                        simulatedMatchingSites.push(dummySites[Math.floor(Math.random() * dummySites.length)]);
                    }
                } else if (aiClassification === "REAL NEWS" && confidenceScore < 0.5) {
                    // If AI thinks it's real but with low confidence, maybe a couple of matches
                     const numMatches = Math.floor(Math.random() * 2); // 0 or 1 match
                     for (let i = 0; i < numMatches; i++) {
                        simulatedMatchingSites.push(dummySites[Math.floor(Math.random() * dummySites.length)]);
                    }
                }
                
                // Add matches based on keywords regardless of AI classification
                if (lowerInput.includes("election") || lowerInput.includes("president") || lowerInput.includes("governor")) {
                    if (lowerInput.includes("daily trust")) {
                        simulatedMatchingSites.push("Daily Trust");
                    }
                    if (lowerInput.includes("premium times")) {
                        simulatedMatchingSites.push("Premium Times");
                    }
                    // Randomly add a political news source if not already added
                    const politicalSources = ["Channels Television", "The Nation", "Arise News", "Vanguard"];
                    if (Math.random() < 0.4 && simulatedMatchingSites.length < 4) {
                        simulatedMatchingSites.push(politicalSources[Math.floor(Math.random() * politicalSources.length)]);
                    }
                }
                
                if (lowerInput.includes("scandal") || lowerInput.includes("lies") || lowerInput.includes("unverified") || lowerInput.includes("breaking")) {
                    const numExtraMatches = Math.floor(Math.random() * 2); // 0 to 1 extra matches
                    for (let i = 0; i < numExtraMatches; i++) {
                         if (simulatedMatchingSites.length < 5) { // Cap at 5 total for display
                            simulatedMatchingSites.push(dummySites[Math.floor(Math.random() * dummySites.length)]);
                        }
                    }
                }

                // Remove duplicates from simulated matches
                simulatedMatchingSites = [...new Set(simulatedMatchingSites)];

                // Update results display
                aiClassificationSpan.textContent = aiClassification;
                aiClassificationSpan.className = `font-semibold ${aiClassification.includes('FAKE') ? 'text-red-600' : 'text-green-600'}`;
                
                confidenceScoreSpan.textContent = confidenceScore.toFixed(2);
                timeSpentSpan.textContent = `${timeTaken} seconds`;
                totalSitesSpan.textContent = totalSitesChecked;
                matchingSitesCountSpan.textContent = simulatedMatchingSites.length;

                // Clear previous list items
                matchingSitesList.innerHTML = '';
                if (simulatedMatchingSites.length > 0) {
                    simulatedMatchingSites.forEach(site => {
                        const listItem = document.createElement('li');
                        listItem.textContent = site;
                        matchingSitesList.appendChild(listItem);
                    });
                    noMatchingSitesP.classList.add('hidden');
                    matchingSitesList.classList.remove('hidden');
                } else {
                    noMatchingSitesP.classList.remove('hidden');
                    matchingSitesList.classList.add('hidden');
                }

                // Hide loading state and enable button
                loadingSpinner.classList.add('hidden');
                buttonText.textContent = "Check News Veracity";
                checkButton.disabled = false;
                resultsDiv.classList.remove('hidden'); // Show results
            });
        });
    </script>
</body>
</html>
